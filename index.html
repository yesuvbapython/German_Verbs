<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>German A1 ‚Äî 30‚ÄëDay Master App (offline)</title>
<style>
  :root{
    --bg:#0b1020; --panel:#0e1530; --card:#121b3a; --chip:#1a2550; --ink:#f7f8ff; --muted:#a9b0c7; --accent:#6aa7ff; --accent2:#9bffd6;
    --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .app{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
  aside{background:var(--panel);border-right:1px solid #1d2a59;padding:16px;position:sticky;top:0;height:100vh;overflow:auto}
  main{padding:20px}
  h1{margin:0 0 8px 0;font-size:24px;letter-spacing:.2px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:16px}
  .search{display:flex;gap:8px;margin:10px 0}
  .search input{flex:1;background:var(--chip);border:1px solid #2a3a76;border-radius:12px;padding:10px 12px;color:var(--ink)}
  .btn{cursor:pointer;background:var(--accent);color:#081025;border:0;border-radius:999px;padding:10px 14px;font-weight:700}
  .btn.secondary{background:var(--chip);color:var(--ink);border:1px solid #2a3a76}
  nav .day{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;color:var(--ink);text-decoration:none;border:1px solid transparent}
  nav .day:hover{background:var(--chip);border-color:#2a3a76}
  nav .day.active{background:linear-gradient(90deg,var(--chip),#22306b);border-color:#3a4aa0}
  nav .tag{font-size:10px;background:#0c1433;border:1px solid #22306b;padding:3px 6px;border-radius:999px;color:var(--muted)}
  nav h3{margin:14px 0 8px 2px;color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.08em}
  header.top{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between;margin-bottom:14px}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .ctl{display:flex;gap:8px;align-items:center;background:var(--card);border:1px solid #21306a;padding:8px 10px;border-radius:12px}
  select,input[type=range]{background:var(--chip);color:var(--ink);border:1px solid #2a3a76;border-radius:8px;padding:6px 8px}
  .grid{display:grid;gap:14px}
  .cols{grid-template-columns:1fr 1fr}
  .card{background:var(--card);border:1px solid #21306a;border-radius:16px;padding:16px}
  .card h2{margin:0 0 10px 0;font-size:18px}
  .card h3{margin:6px 0 8px 0;font-size:14px;color:var(--accent)}
  .pill{display:inline-block;background:var(--chip);border:1px solid #2a3a76;color:var(--ink);padding:6px 8px;border-radius:999px;font-size:12px;margin:4px 6px 0 0}
  .muted{color:var(--muted)}
  .list{display:grid;gap:10px}
  .item{background:var(--chip);border:1px solid #2a3a76;border-radius:12px;padding:10px}
  .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .de{font-weight:700}
  .en{color:var(--muted)}
  .ipa{color:var(--muted);font-size:12px}
  .speak{cursor:pointer;background:var(--chip);border:1px solid #2a3a76;border-radius:10px;padding:6px 10px;color:var(--ink)}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px dotted #2a3a76;padding:8px 6px;text-align:left}
  th{color:var(--muted);font-weight:600}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  details{background:var(--chip);border:1px solid #2a3a76;border-radius:12px;padding:10px}
  details>summary{cursor:pointer;font-weight:700}
  .legend{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
  .legend .k{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid #2a3a76;background:var(--chip)}
  .footer{margin-top:14px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="app">
  <aside>
    <h1>üá©üá™ A1 ‚Äî 30‚ÄëDay Plan</h1>
    <div class="sub">Offline practice app with TTS (üîä). Choose a day below.</div>
    <div class="search">
      <input id="q" placeholder="Search verbs / sentences (e.g., schlafen, Frage)‚Ä¶"/>
      <button class="btn secondary" id="btnSearch">Search</button>
    </div>
    <nav id="days"></nav>
    <div class="footer">Tip: Use <span class="pill">Play Day</span> to hear all German sentences.</div>
  </aside>
  <main>
    <header class="top">
      <div>
        <div style="font-weight:700">Day <span id="dayNo">1</span>: <span id="dayTitle">Foundations</span></div>
        <div class="sub" id="daySub">Pronouns, sein/haben, greetings</div>
      </div>
      <div class="controls">
        <div class="ctl"><label style="font-size:12px" for="deVoice">DE voice</label><select id="deVoice"></select></div>
        <div class="ctl"><label style="font-size:12px" for="enVoice">EN voice</label><select id="enVoice"></select></div>
        <div class="ctl"><label style="font-size:12px" for="rate">Rate</label><input id="rate" type="range" min="0.7" max="1.3" step="0.05" value="1"/></div>
        <div class="ctl"><label style="font-size:12px" for="pitch">Pitch</label><input id="pitch" type="range" min="0.7" max="1.3" step="0.05" value="1"/></div>
        <button class="btn" id="playDay">‚ñ∂ Play Day (DE)</button>
        <button class="btn secondary" id="stopAll">‚ñ† Stop</button>
      </div>
    </header>
    <section class="grid cols">
      <div class="card" id="grammarCard">
        <h2>üèóÔ∏è Grammar</h2>
        <div class="legend">
          <div class="k">Blue = Noun</div>
          <div class="k">Red = Verb</div>
          <div class="k">Green = Adjective</div>
          <div class="k">Word order: Verb is 2nd</div>
        </div>
        <div id="grammar"></div>
      </div>
      <div class="card">
        <h2>üîë Verbs of the Day</h2>
        <div class="sub" id="verbCount"></div>
        <div style="overflow:auto;max-height:380px;border:1px solid #22306b;border-radius:12px">
          <table id="verbTable">
            <thead><tr><th>Infinitive</</th><th>English</th><th>ich</th><th>du</th><th>er/sie</th><th>wir</th><th>ihr</th><th>sie/Sie</th><th>üîä</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
    <section class="grid" style="margin-top:14px">
      <div class="card">
        <h2>üí¨ Sentences Practice</h2>
        <div id="sentences" class="list"></div>
      </div>
      <div class="card">
        <h2>üé≠ Dialogues</h2>
        <div id="dialogs" class="list"></div>
      </div>
    </section>
    <div class="footer">All content offline. Voices use your browser's TTS. If no German voice appears, try Chrome/Edge or install a German voice in OS.</div>
  </main>
</div>

<script>
/***********************
 *  DATA & CURRICULUM  *
 ***********************/
// Conjugation helpers
const ENDINGS = { ich: 'e', du: 'st', er: 't', wir: 'en', ihr: 't', sie: 'en' };
function stemOf(inf){
  if(inf.endsWith('eln')) return inf.slice(0,-3);
  if(inf.endsWith('ern')) return inf.slice(0,-3);
  if(inf.endsWith('en')) return inf.slice(0,-2);
  if(inf.endsWith('n')) return inf.slice(0,-1);
  return inf;
}
function conjRegular(inf){
  const s = stemOf(inf);
  const duExtra = /[tdn]$/.test(s) ? 'e' : ''; // e-insertion for arbeiten, reden, etc.
  return {
    ich: s+ENDINGS.ich,
    du: s+duExtra+ENDINGS.du,
    er: s+ENDINGS.er,
    wir: s+ENDINGS.wir,
    ihr: s+ENDINGS.ihr,
    sie: s+ENDINGS.sie
  };
}
function combineSeparable(prefix, verb){
  const c = conjRegular(verb);
  return {
    ich: c.ich+` ${prefix}`,
    du: c.du+` ${prefix}`,
    er: c.er+` ${prefix}`,
    wir: c.wir+` ${prefix}`,
    ihr: c.ihr+` ${prefix}`,
    sie: c.sie+` ${prefix}`,
  };
}

// Irregular overrides (A1)
const IRR = {
  sein: { ich:'bin', du:'bist', er:'ist', wir:'sind', ihr:'seid', sie:'sind' },
  haben:{ ich:'habe',du:'hast',er:'hat',wir:'haben',ihr:'habt',sie:'haben' },
  werden:{ich:'werde',du:'wirst',er:'wird',wir:'werden',ihr:'werdet',sie:'werden'},
  k√∂nnen:{ich:'kann',du:'kannst',er:'kann',wir:'k√∂nnen',ihr:'k√∂nnt',sie:'k√∂nnen'},
  wollen:{ich:'will',du:'willst',er:'will',wir:'wollen',ihr:'wollt',sie:'wollen'},
  m√ºssen:{ich:'muss',du:'musst',er:'muss',wir:'m√ºssen',ihr:'m√ºsst',sie:'m√ºssen'},
  d√ºrfen:{ich:'darf',du:'darfst',er:'darf',wir:'d√ºrfen',ihr:'d√ºrft',sie:'d√ºrfen'},
  sollen:{ich:'soll',du:'sollst',er:'soll',wir:'sollen',ihr:'sollt',sie:'sollen'},
  m√∂gen:{ich:'mag',du:'magst',er:'mag',wir:'m√∂gen',ihr:'m√∂gt',sie:'m√∂gen'},
  essen:{ich:'esse',du:'isst',er:'isst',wir:'essen',ihr:'esst',sie:'essen'},
  lesen:{ich:'lese',du:'liest',er:'liest',wir:'lesen',ihr:'lest',sie:'lesen'},
  sehen:{ich:'sehe',du:'siehst',er:'sieht',wir:'sehen',ihr:'seht',sie:'sehen'},
  sprechen:{ich:'spreche',du:'sprichst',er:'spricht',wir:'sprechen',ihr:'sprecht',sie:'sprechen'},
  nehmen:{ich:'nehme',du:'nimmst',er:'nimmt',wir:'nehmen',ihr:'nehmt',sie:'nehmen'},
  geben:{ich:'gebe',du:'gibst',er:'gibt',wir:'geben',ihr:'gebt',sie:'geben'},
  fahren:{ich:'fahre',du:'f√§hrst',er:'f√§hrt',wir:'fahren',ihr:'fahrt',sie:'fahren'},
  laufen:{ich:'laufe',du:'l√§ufst',er:'l√§uft',wir:'laufen',ihr:'lauft',sie:'laufen'},
  schlafen:{ich:'schlafe',du:'schl√§fst',er:'schl√§ft',wir:'schlafen',ihr:'schlaft',sie:'schlafen'},
  tragen:{ich:'trage',du:'tr√§gst',er:'tr√§gt',wir:'tragen',ihr:'tragt',sie:'tragen'},
  waschen:{ich:'wasche',du:'w√§schst',er:'w√§scht',wir:'waschen',ihr:'wascht',sie:'waschen'},
  helfen:{ich:'helfe',du:'hilfst',er:'hilft',wir:'helfen',ihr:'helft',sie:'helfen'},
  wissen:{ich:'wei√ü',du:'wei√üt',er:'wei√ü',wir:'wissen',ihr:'wisst',sie:'wissen'},
  gefallen:{ich:'gefalle',du:'gef√§llst',er:'gef√§llt',wir:'gefallen',ihr:'gefallt',sie:'gefallen'},
  hei√üen:{ich:'hei√üe',du:'hei√üt',er:'hei√üt',wir:'hei√üen',ihr:'hei√üt',sie:'hei√üen'}
};

// Verb DB (lite pack ~250+). You can extend by adding more entries.
const VERB_DB = [
  // Core
  {inf:'sein', en:'to be', class:'irr', aux:'sein'},
  {inf:'haben', en:'to have', class:'irr', aux:'haben'},
  {inf:'werden', en:'to become; will', class:'irr', aux:'sein'},
  {inf:'k√∂nnen', en:'can, to be able to', class:'irr', aux:'haben'},
  {inf:'m√ºssen', en:'must, to have to', class:'irr', aux:'haben'},
  {inf:'wollen', en:'to want', class:'irr', aux:'haben'},
  {inf:'d√ºrfen', en:'may, to be allowed to', class:'irr', aux:'haben'},
  {inf:'sollen', en:'should, to be supposed to', class:'irr', aux:'haben'},
  {inf:'m√∂gen', en:'to like', class:'irr', aux:'haben'},

  // Basics
  {inf:'hei√üen', en:'to be called', class:'irr', aux:'haben'},
  {inf:'machen', en:'to do, make', class:'reg', aux:'haben'},
  {inf:'gehen', en:'to go', class:'reg', aux:'sein'},
  {inf:'kommen', en:'to come', class:'reg', aux:'sein'},
  {inf:'sprechen', en:'to speak', class:'irr', aux:'haben'},
  {inf:'sagen', en:'to say', class:'reg', aux:'haben'},
  {inf:'finden', en:'to find', class:'reg', aux:'haben'},
  {inf:'bringen', en:'to bring', class:'reg', aux:'haben'},
  {inf:'denken', en:'to think', class:'reg', aux:'haben'},
  {inf:'arbeiten', en:'to work', class:'reg', aux:'haben'},
  {inf:'lernen', en:'to learn', class:'reg', aux:'haben'},
  {inf:'studieren', en:'to study', class:'reg', aux:'haben'},
  {inf:'spielen', en:'to play', class:'reg', aux:'haben'},
  {inf:'schlafen', en:'to sleep', class:'irr', aux:'haben'},
  {inf:'essen', en:'to eat', class:'irr', aux:'haben'},
  {inf:'trinken', en:'to drink', class:'reg', aux:'haben'},
  {inf:'sehen', en:'to see', class:'irr', aux:'haben'},
  {inf:'h√∂ren', en:'to hear', class:'reg', aux:'haben'},
  {inf:'lesen', en:'to read', class:'irr', aux:'haben'},
  {inf:'schreiben', en:'to write', class:'reg', aux:'haben'},
  {inf:'fahren', en:'to drive, go (veh.)', class:'irr', aux:'sein'},
  {inf:'laufen', en:'to run', class:'irr', aux:'sein'},
  {inf:'bleiben', en:'to stay', class:'reg', aux:'sein'},
  {inf:'wohnen', en:'to live (reside)', class:'reg', aux:'haben'},
  {inf:'leben', en:'to live (be alive)', class:'reg', aux:'haben'},
  {inf:'brauchen', en:'to need', class:'reg', aux:'haben'},
  {inf:'warten', en:'to wait', class:'reg', aux:'haben'},
  {inf:'fragen', en:'to ask', class:'reg', aux:'haben'},
  {inf:'antworten', en:'to answer', class:'reg', aux:'haben'},
  {inf:'verstehen', en:'to understand', class:'reg', aux:'haben'},
  {inf:'erkl√§ren', en:'to explain', class:'reg', aux:'haben'},
  {inf:'versuchen', en:'to try', class:'reg', aux:'haben'},
  {inf:'benutzen', en:'to use', class:'reg', aux:'haben'},
  {inf:'√∂ffnen', en:'to open', class:'reg', aux:'haben'},
  {inf:'schlie√üen', en:'to close', class:'reg', aux:'haben'},
  {inf:'kaufen', en:'to buy', class:'reg', aux:'haben'},
  {inf:'verkaufen', en:'to sell', class:'reg', aux:'haben'},
  {inf:'bezahlen', en:'to pay', class:'reg', aux:'haben'},
  {inf:'nehmen', en:'to take', class:'irr', aux:'haben'},
  {inf:'geben', en:'to give', class:'irr', aux:'haben'},
  {inf:'tragen', en:'to wear, carry', class:'irr', aux:'haben'},
  {inf:'ziehen', en:'to pull', class:'reg', aux:'haben'},
  {inf:'legen', en:'to lay, put (horizontal)', class:'reg', aux:'haben'},
  {inf:'stellen', en:'to put, place (vertical)', class:'reg', aux:'haben'},
  {inf:'setzen', en:'to set, seat', class:'reg', aux:'haben'},
  {inf:'sitzen', en:'to sit', class:'reg', aux:'haben'},
  {inf:'stehen', en:'to stand', class:'reg', aux:'haben'},
  {inf:'liegen', en:'to lie (be located)', class:'reg', aux:'haben'},
  {inf:'beginnen', en:'to begin', class:'reg', aux:'haben'},
  {inf:'enden', en:'to end', class:'reg', aux:'haben'},
  {inf:'helfen', en:'to help', class:'irr', aux:'haben'},
  {inf:'bekommen', en:'to receive, get', class:'reg', aux:'haben'},
  {inf:'suchen', en:'to search', class:'reg', aux:'haben'},
  {inf:'glauben', en:'to believe', class:'reg', aux:'haben'},
  {inf:'wissen', en:'to know (fact)', class:'irr', aux:'haben'},
  {inf:'kennen', en:'to know (person/place)', class:'reg', aux:'haben'},
  {inf:'f√ºhlen', en:'to feel', class:'reg', aux:'haben'},
  {inf:'reisen', en:'to travel', class:'reg', aux:'sein'},
  {inf:'fliegen', en:'to fly', class:'reg', aux:'sein'},
  {inf:'schicken', en:'to send', class:'reg', aux:'haben'},
  {inf:'holen', en:'to fetch', class:'reg', aux:'haben'},
  {inf:'mitbringen', en:'to bring along', class:'sep', aux:'haben', prefix:'mit', base:'bringen'},
  {inf:'mitkommen', en:'to come along', class:'sep', aux:'sein', prefix:'mit', base:'kommen'},
  {inf:'aufstehen', en:'to get up', class:'sep', aux:'sein', prefix:'auf', base:'stehen'},
  {inf:'einkaufen', en:'to shop', class:'sep', aux:'haben', prefix:'ein', base:'kaufen'},
  {inf:'zuh√∂ren', en:'to listen (closely)', class:'sep', aux:'haben', prefix:'zu', base:'h√∂ren'},
  {inf:'anrufen', en:'to call (phone)', class:'sep', aux:'haben', prefix:'an', base:'rufen'},
  {inf:'aufmachen', en:'to open (colloq.)', class:'sep', aux:'haben', prefix:'auf', base:'machen'},
  {inf:'zumachen', en:'to close (colloq.)', class:'sep', aux:'haben', prefix:'zu', base:'machen'},
  {inf:'aufr√§umen', en:'to tidy up', class:'sep', aux:'haben', prefix:'auf', base:'r√§umen'},
  {inf:'einladen', en:'to invite', class:'sep', aux:'haben', prefix:'ein', base:'laden'},
  {inf:'fernsehen', en:'to watch TV', class:'sepirr', aux:'haben', prefix:'fern', base:'sehen'},
  {inf:'vorstellen', en:'to introduce; imagine', class:'sep', aux:'haben', prefix:'vor', base:'stellen'},
  {inf:'teilnehmen', en:'to take part', class:'sepirr', aux:'haben', prefix:'teil', base:'nehmen'},
  {inf:'aussteigen', en:'to get off', class:'sep', aux:'sein', prefix:'aus', base:'steigen'},
  {inf:'einsteigen', en:'to get on', class:'sep', aux:'sein', prefix:'ein', base:'steigen'},
  {inf:'umsteigen', en:'to change (train/bus)', class:'sep', aux:'sein', prefix:'um', base:'steigen'},
  {inf:'zur√ºckkommen', en:'to come back', class:'sep', aux:'sein', prefix:'zur√ºck', base:'kommen'},
  {inf:'zur√ºckgeben', en:'to give back', class:'sep', aux:'haben', prefix:'zur√ºck', base:'geben'},
  {inf:'aufwachen', en:'to wake up', class:'sep', aux:'sein', prefix:'auf', base:'wachen'},
  {inf:'spazierengehen', en:'to go for a walk', class:'comp', aux:'sein'},
  {inf:'vorbereiten', en:'to prepare', class:'sep', aux:'haben', prefix:'vor', base:'bereiten'},
  {inf:'unterschreiben', en:'to sign', class:'reg', aux:'haben'},
  {inf:'aufschreiben', en:'to write down', class:'sep', aux:'haben', prefix:'auf', base:'schreiben'},
  {inf:'erz√§hlen', en:'to tell (a story)', class:'reg', aux:'haben'},
  {inf:'feiern', en:'to celebrate', class:'reg', aux:'haben'},
  {inf:'kochen', en:'to cook', class:'reg', aux:'haben'},
  {inf:'backen', en:'to bake', class:'reg', aux:'haben'},
  {inf:'bestellen', en:'to order', class:'reg', aux:'haben'},
  {inf:'probieren', en:'to try (food/clothes)', class:'reg', aux:'haben'},
  {inf:'schmecken', en:'to taste', class:'reg', aux:'haben'},
  {inf:'unterrichten', en:'to teach', class:'reg', aux:'haben'},
  {inf:'erinnern', en:'to remind/remember', class:'reg', aux:'haben'},
  {inf:'vergessen', en:'to forget', class:'irr', aux:'haben'},
  {inf:'lieben', en:'to love', class:'reg', aux:'haben'},
  {inf:'hassen', en:'to hate', class:'reg', aux:'haben'},
  {inf:'mieten', en:'to rent', class:'reg', aux:'haben'},
  {inf:'vermieten', en:'to rent out', class:'reg', aux:'haben'},
  {inf:'putzen', en:'to clean', class:'reg', aux:'haben'},
  {inf:'waschen', en:'to wash', class:'irr', aux:'haben'},
  {inf:'reparieren', en:'to repair', class:'reg', aux:'haben'},
  {inf:'schneiden', en:'to cut', class:'reg', aux:'haben'},
  {inf:'aufh√∂ren', en:'to stop', class:'sep', aux:'haben', prefix:'auf', base:'h√∂ren'},
  {inf:'weitergehen', en:'to continue (go on)', class:'comp', aux:'sein'},
  {inf:'mitteilen', en:'to inform', class:'sep', aux:'haben', prefix:'mit', base:'teilen'},
  {inf:'einreichen', en:'to submit', class:'sep', aux:'haben', prefix:'ein', base:'reichen'},
  {inf:'abholen', en:'to pick up', class:'sep', aux:'haben', prefix:'ab', base:'holen'},
  {inf:'ansehen', en:'to look at', class:'sepirr', aux:'haben', prefix:'an', base:'sehen'},
  {inf:'aussehen', en:'to look/appear', class:'sepirr', aux:'haben', prefix:'aus', base:'sehen'},
  {inf:'mitnehmen', en:'to take along', class:'sepirr', aux:'haben', prefix:'mit', base:'nehmen'},
  {inf:'vorhaben', en:'to plan (intend)', class:'sep', aux:'haben', prefix:'vor', base:'haben'},
  {inf:'zur√ºckrufen', en:'to call back', class:'sep', aux:'haben', prefix:'zur√ºck', base:'rufen'},
  {inf:'ausf√ºllen', en:'to fill out', class:'sep', aux:'haben', prefix:'aus', base:'f√ºllen'},
  {inf:'einschlafen', en:'to fall asleep', class:'sepirr', aux:'sein', prefix:'ein', base:'schlafen'},
  {inf:'umziehen', en:'to move (house)', class:'sep', aux:'sein', prefix:'um', base:'ziehen'},
  {inf:'anziehen', en:'to put on (clothes)', class:'sep', aux:'haben', prefix:'an', base:'ziehen'},
  {inf:'ausziehen', en:'to take off (clothes)', class:'sep', aux:'haben', prefix:'aus', base:'ziehen'},

  // Week 7 additions
  {inf:'fr√ºhst√ºcken', en:'to eat breakfast', class:'reg', aux:'haben'},
  {inf:'dauern', en:'to last (duration)', class:'reg', aux:'haben'},
  {inf:'scheinen', en:'to seem/shine', class:'reg', aux:'haben'},
  {inf:'wirken', en:'to have an effect', class:'reg', aux:'haben'},
  {inf:'halten', en:'to hold/stop', class:'reg', aux:'haben'},
  {inf:'nennen', en:'to name/call', class:'reg', aux:'haben'},
  {inf:'beschreiben', en:'to describe', class:'reg', aux:'haben'},
  {inf:'vergleichen', en:'to compare', class:'reg', aux:'haben'},
  {inf:'messen', en:'to measure', class:'reg', aux:'haben'},
  {inf:'steigen', en:'to rise/climb', class:'reg', aux:'sein'},
  {inf:'sinken', en:'to sink/decrease', class:'reg', aux:'sein'},
  {inf:'verbessern', en:'to improve', class:'reg', aux:'haben'},
  {inf:'verschlechtern', en:'to worsen', class:'reg', aux:'haben'},
  {inf:'√§ndern', en:'to change', class:'reg', aux:'haben'},
  {inf:'klingen', en:'to sound', class:'reg', aux:'haben'},
  {inf:'geh√∂ren', en:'to belong to', class:'reg', aux:'haben'},
  {inf:'folgen', en:'to follow', class:'reg', aux:'sein'},
  {inf:'passen', en:'to fit', class:'reg', aux:'haben'},
  {inf:'gefallen', en:'to please', class:'irr', aux:'haben'},
  {inf:'danken', en:'to thank', class:'reg', aux:'haben'},
  {inf:'gratulieren', en:'to congratulate', class:'reg', aux:'haben'},
  {inf:'schenken', en:'to gift', class:'reg', aux:'haben'},
  {inf:'reden', en:'to talk', class:'reg', aux:'haben'},
  {inf:'schmerzen', en:'to ache', class:'reg', aux:'haben'}
];

function pair(de,en){return {de,en};}
function dlg(title, lines){return {title, lines};}

// Curriculum per day
const DAYS = [
  {title:'Foundations', sub:'Pronouns, sein/haben, greetings', topics:[
    {h:'Pronouns', body:'ich, du, er/sie/es, wir, ihr, sie/Sie ‚Äî Verb is 2nd in main clause.'},
    {h:'sein/haben', body:'Ich bin Esu. Du bist m√ºde. Ich habe Zeit.'},
    {h:'Greetings', body:'Guten Morgen! Hallo! Wie geht es dir/Ihnen?'}
  ], verbs:['sein','haben','machen','gehen','kommen','sprechen','lernen','spielen','wohnen','hei√üen','arbeiten','essen','trinken','lesen','schreiben','h√∂ren'],
  dialogs:[dlg('Hallo & Vorstellen',[['A','Hallo! Ich hei√üe Esu. Wie hei√üt du?'],['B','Ich hei√üe Max. Freut mich!'],['A','Freut mich auch. Ich komme aus Indien.'],['B','Willkommen!']])],
  sentences:[ pair('Ich bin Esu.','I am Esu.'), pair('Ich habe Zeit.','I have time.'), pair('Ich wohne in Hyderabad.','I live in Hyderabad.'), pair('Wie hei√üt du?','What is your name?') ]
  },

  {title:'Numbers & haben', sub:'haben + numbers + family', topics:[
    {h:'Numbers 0‚Äì100', body:'null, eins, zwei, drei, vier, f√ºnf ‚Ä¶ zehn ‚Ä¶ hundert.'},
    {h:'haben', body:'Ich habe zwei Kinder. Hast du Geschwister?'}
  ], verbs:['haben','zahlen','kosten','kaufen','verkaufen','bezahlen','finden','suchen','brauchen','warten','fragen','antworten','sehen','nehmen','geben','bringen'],
  dialogs:[dlg('Im Laden',[['Kunde','Wie viel kostet das?'],['Verk√§ufer','Das kostet zehn Euro.'],['Kunde','Ich nehme es.']])],
  sentences:[ pair('Ich habe eine Frage.','I have a question.'), pair('Wie viel kostet das?','How much does that cost?') ]
  },

  {title:'Regular verbs', sub:'Conjugation patterns', topics:[{h:'-en verbs', body:'spielen ‚Üí ich spiele, du spielst, er spielt ‚Ä¶'}],
   verbs:['spielen','lernen','machen','arbeiten','reisen','leben','wohnen','brauchen','schicken','holen','√∂ffnen','schlie√üen','tragen','legen','stellen','setzen'],
   dialogs:[dlg('Freizeit',[['A','Spielst du Fu√üball?'],['B','Ja, ich spiele am Wochenende.']])],
   sentences:[ pair('Ich arbeite heute nicht.','I am not working today.'), pair('Wir lernen Deutsch.','We are learning German.') ]
  },

  {title:'Word order & Yes/No', sub:'Verb-second; Ja/Nein-Fragen', topics:[{h:'Verb-second', body:'Heute arbeite ich. Morgen fahre ich.'},{h:'Yes/No', body:'Arbeitest du heute? Ja/Nein.'}],
   verbs:['fahren','laufen','bleiben','denken','glauben','wissen','kennen','helfen','kommen','gehen','h√∂ren','lesen','schreiben','sprechen','sehen','finden'],
   dialogs:[dlg('Termin',[['A','Kommst du morgen?'],['B','Ja, ich komme um neun.']])],
   sentences:[ pair('Heute lerne ich viel.','Today I study a lot.'), pair('Kommst du morgen?','Are you coming tomorrow?') ]
  },

  {title:'W‚Äëquestions', sub:'wer, was, wo, wann, wie, warum', topics:[{h:'W‚ÄëFragen', body:'Wer bist du? Wo wohnst du? Wie sp√§t ist es?'}],
   verbs:['fragen','antworten','finden','suchen','sehen','nehmen','geben','bringen','holen','mitbringen','anrufen','aufstehen','einkaufen','zuh√∂ren','aufmachen','zumachen'],
   dialogs:[dlg('Information',[['A','Wo ist die Haltestelle?'],['B','Da dr√ºben, links.']])],
   sentences:[ pair('Wo wohnst du?','Where do you live?'), pair('Wann beginnt der Film?','When does the movie start?') ]
  },

  {title:'Negation', sub:'nicht / kein', topics:[{h:'nicht', body:'Negates verbs/adjectives/adverbs: Ich arbeite nicht.'},{h:'kein', body:'Negates nouns: Ich habe kein Auto.'}],
   verbs:['haben','sein','machen','arbeiten','brauchen','m√∂gen','wollen','k√∂nnen','m√ºssen','d√ºrfen','sollen','lieben','hassen','benutzen','versuchen','verstehen'],
   dialogs:[dlg('Absage',[['A','Kommst du heute?'],['B','Leider nicht. Ich habe keine Zeit.']])],
   sentences:[ pair('Ich habe kein Geld.','I have no money.'), pair('Ich komme heute nicht.','I am not coming today.') ]
  },

  {title:'Review 1', sub:'Daily routine', topics:[{h:'Tagesablauf', body:'aufstehen, fr√ºhst√ºcken, arbeiten, lernen, schlafen'}],
   verbs:['aufstehen','fr√ºhst√ºcken','arbeiten','lernen','einkaufen','kochen','essen','fernsehen','lesen','schreiben','spazierengehen','schlafen','aufr√§umen','putzen','waschen','aufh√∂ren'],
   dialogs:[dlg('Alltag',[['A','Wann stehst du auf?'],['B','Ich stehe um sechs auf.']])],
   sentences:[ pair('Ich stehe um sechs auf.','I get up at six.'), pair('Abends sehe ich fern.','In the evening I watch TV.') ]
  },

  // Week 2
  {title:'Articles & Plurals', sub:'der/die/das + plural patterns', topics:[{h:'Articles', body:'der (m), die (f, pl), das (n).'}, {h:'Plurals', body:'der Tisch ‚Üí die Tische; die Frau ‚Üí die Frauen'}],
   verbs:['kaufen','verkaufen','bezahlen','bestellen','probieren','schmecken','tragen','anziehen','ausziehen','mitnehmen','einladen','feiern','erz√§hlen','zeigen','suchen','finden'],
   dialogs:[dlg('Im Restaurant',[['Gast','Ich bestelle eine Suppe.'],['Kellner','Sehr gern. M√∂chten Sie noch etwas?']])],
   sentences:[ pair('Das ist ein sch√∂ner Tisch.','That is a beautiful table.'), pair('Ich bestelle eine Pizza.','I order a pizza.') ]
  },

  {title:'Accusative', sub:'den/einen; mich, dich‚Ä¶', topics:[{h:'Akkusativ', body:'Ich sehe <b style="color:#9bd">den</b> Mann. Ich habe <b style="color:#9bd">einen</b> Hund.'}],
   verbs:['sehen','treffen','besuchen','brauchen','haben','nehmen','kaufen','tragen','finden','suchen','m√∂gen','lieben','hassen','√∂ffnen','schlie√üen','benutzen'],
   dialogs:[dlg('Einkauf',[['A','Ich brauche einen Laptop.'],['B','Ich habe einen guten Tipp.']])],
   sentences:[ pair('Ich sehe den Bus.','I see the bus.'), pair('Er hat einen Termin.','He has an appointment.') ]
  },

  {title:'Accusative Pronouns', sub:'mich/dich/ihn/sie/es/uns/euch/Sie', topics:[{h:'Pronouns', body:'Ich liebe <b>dich</b>. Er kennt <b>sie</b>.'}],
   verbs:['lieben','kennen','einladen','treffen','anrufen','mitnehmen','fragen','verstehen','helfen','sehen','h√∂ren','lesen','schreiben','erz√§hlen','sagen','bringen'],
   dialogs:[dlg('Freunde',[['A','Ich rufe dich sp√§ter an.'],['B','Okay, danke!']])],
   sentences:[ pair('Ich sehe dich morgen.','I see you tomorrow.'), pair('Er versteht sie.','He understands her.') ]
  },

  {title:'Modal verbs', sub:'k√∂nnen/m√ºssen/wollen‚Ä¶ + infinitive', topics:[{h:'Modal + V', body:'Ich <b>kann</b> heute nicht kommen. Wir <b>m√ºssen</b> arbeiten.'}],
   verbs:['k√∂nnen','m√ºssen','wollen','d√ºrfen','sollen','m√∂gen','fahren','gehen','kommen','lernen','arbeiten','sprechen','schreiben','lesen','sehen','spielen'],
   dialogs:[dlg('Pflichten',[['A','Ich muss heute lange arbeiten.'],['B','Dann kannst du morgen kommen.']])],
   sentences:[ pair('Ich kann heute nicht.','I cannot today.'), pair('Wir m√ºssen jetzt gehen.','We must go now.') ]
  },

  {title:'Dative', sub:'dem/einem; mir/dir/‚Ä¶', topics:[{h:'Dativ', body:'Ich helfe <b>dem</b> Freund. Ich gebe <b>dem</b> Kind ein Buch.'}],
   verbs:['helfen','danken','gratulieren','geh√∂ren','folgen','passen','gefallen','schmecken','antworten','glauben','erz√§hlen','zeigen','geben','schenken','bringen','mitteilen'],
   dialogs:[dlg('Geschenk',[['A','Ich gebe dem Kind ein Spiel.'],['B','Das gef√§llt ihm sehr!']])],
   sentences:[ pair('Ich helfe dem Mann.','I help the man.'), pair('Das passt mir.','That fits me.') ]
  },

  {title:'Two‚Äëcase preps', sub:'an, auf, in‚Ä¶ (Akk/Dativ)', topics:[{h:'Wechselpr√§positionen', body:'in, an, auf, unter, √ºber‚Ä¶ Akk=movement (Wohin?), Dat=location (Wo?)'}],
   verbs:['legen','stellen','setzen','h√§ngen','liegen','stehen','sitzen','gehen','kommen','fahren','bringen','mitbringen','abholen','aufmachen','zumachen','einr√§umen'],
   dialogs:[dlg('Wohin/Wo',[['A','Wohin stellst du den Stuhl?'],['B','Ich stelle ihn an den Tisch.']])],
   sentences:[ pair('Das Buch liegt auf dem Tisch.','The book lies on the table.'), pair('Ich h√§nge das Bild an die Wand.','I hang the picture on the wall.') ]
  },

  {title:'Review 2', sub:'Shopping & Family', topics:[{h:'Themen', body:'Einkaufen, Familie, Kleidung, Farben'}],
   verbs:['kaufen','verkaufen','tragen','anziehen','ausziehen','suchen','finden','zeigen','erz√§hlen','lieben','m√∂gen','mieten','vermieten','bezahlen','bestellen','probieren'],
   dialogs:[dlg('Kleidung',[['A','Passt die Jacke?'],['B','Ja, sie passt mir.']])],
   sentences:[ pair('Ich suche eine blaue Hose.','I am looking for blue pants.') ]
  },

  // Week 3
  {title:'Possessives', sub:'mein/dein/sein/ihr/unser/euer/Ihr', topics:[{h:'Possessive', body:'mein Vater, deine Mutter, sein Auto, unsere Wohnung'}],
   verbs:['haben','geh√∂ren','tragen','zeigen','geben','nehmen','bringen','mitbringen','kaufen','bezahlen','benutzen','brauchen','wollen','m√∂gen','lieben','suchen'],
   dialogs:[dlg('Familie',[['A','Ist das dein Bruder?'],['B','Ja, das ist mein Bruder.']])],
   sentences:[ pair('Ist das dein Buch?','Is that your book?') ]
  },

  {title:'Adj. endings I', sub:'ein sch√∂ner Tag‚Ä¶', topics:[{h:'Adjektive', body:'Nach unbestimmtem Artikel: ein sch√∂ner Tag / eine sch√∂ne Stadt / ein sch√∂nes Haus.'}],
   verbs:['sein','werden','finden','halten','machen','scheinen','aussehen','bleiben','wirken','f√ºhlen','schmecken','klingen','hei√üen','nennen','zeigen','beschreiben'],
   dialogs:[dlg('Beschreibung',[['A','Das ist ein sch√∂nes Zimmer.'],['B','Ja, sehr hell.']])],
   sentences:[ pair('Das ist ein sch√∂nes Haus.','That is a beautiful house.') ]
  },

  {title:'Comparisons', sub:'gr√∂√üer, am gr√∂√üten', topics:[{h:'Komparativ/Superlativ', body:'gro√ü ‚Äì gr√∂√üer ‚Äì am gr√∂√üten; gut ‚Äì besser ‚Äì am besten'}],
   verbs:['sein','werden','finden','m√∂gen','lieben','wollen','kaufen','bezahlen','vergleichen','messen','steigen','sinken','verbessern','verschlechtern','√§ndern','scheinen'],
   dialogs:[dlg('Vergleich',[['A','Dieser Weg ist k√ºrzer.'],['B','Aber der andere ist besser.']])],
   sentences:[ pair('Heute ist es w√§rmer.','Today it is warmer.') ]
  },

  {title:'Time expressions', sub:'um, am, im; heute, morgen', topics:[{h:'Zeit', body:'um 9 Uhr; am Montag; im Juni; heute, morgen, gestern'}],
   verbs:['beginnen','enden','dauern','warten','kommen','gehen','fahren','planen','vorhaben','treffen','anrufen','aufstehen','einschlafen','aufwachen','vorbereiten','einladen'],
   dialogs:[dlg('Termin 2',[['A','Treffen wir uns am Freitag?'],['B','Ja, um 18 Uhr.']])],
   sentences:[ pair('Ich komme am Montag.','I come on Monday.') ]
  },

  {title:'Separable verbs', sub:'aufstehen, einkaufen‚Ä¶', topics:[{h:'Trennbar', body:'Ich stehe um 6 Uhr auf. Er kauft heute ein.'}],
   verbs:['aufstehen','einkaufen','zuh√∂ren','anrufen','mitkommen','mitnehmen','aufmachen','zumachen','aufr√§umen','einladen','fernsehen','zur√ºckkommen','zur√ºckgeben','aufschreiben','vorstellen','vorbereiten'],
   dialogs:[dlg('Morgenroutine',[['A','Stehst du fr√ºh auf?'],['B','Ja, um sechs.']])],
   sentences:[ pair('Wir kaufen heute ein.','We are shopping today.') ]
  },

  {title:'Prepositions (common)', sub:'mit, ohne, f√ºr, bei, nach, zu‚Ä¶', topics:[{h:'Pr√§positionen', body:'mit (Dat), ohne (Akk), f√ºr (Akk), bei (Dat), nach (Dat), zu (Dat)'}],
   verbs:['gehen','fahren','kommen','reisen','arbeiten','wohnen','leben','helfen','sprechen','treffen','suchen','finden','bezahlen','warten','denken','glauben'],
   dialogs:[dlg('Wegbeschreibung',[['A','Ich gehe mit dir zum Bahnhof.'],['B','Super, danke!']])],
   sentences:[ pair('Ich fahre nach Berlin.','I go to Berlin.') ]
  },

  {title:'Review 3', sub:'Family, work, travel', topics:[{h:'Themen', body:'Familie, Arbeit, Reisen ‚Äî Rollenspiele'}],
   verbs:['reisen','fahren','kommen','mitkommen','umsteigen','einsteigen','aussteigen','einladen','mitnehmen','helfen','fragen','antworten','zeigen','erz√§hlen','warten','planen'],
   dialogs:[dlg('Am Bahnhof',[['A','Wann f√§hrt der Zug nach Frankfurt?'],['B','Um 9:30 Uhr, Gleis 3.']])],
   sentences:[ pair('Wir steigen in Berlin um.','We change trains in Berlin.') ]
  },

  // Week 4
  {title:'Perfekt I', sub:'haben/sein + Partizip II', topics:[{h:'Perfekt', body:'Ich habe gearbeitet. Ich bin gekommen.'}],
   verbs:['machen','lernen','arbeiten','gehen','kommen','fahren','reisen','bleiben','trinken','essen','lesen','schreiben','sehen','sprechen','spielen','kaufen'],
   dialogs:[dlg('Gestern',[['A','Was hast du gestern gemacht?'],['B','Ich habe gelernt und Sport gemacht.']])],
   sentences:[ pair('Ich habe Kaffee getrunken.','I drank coffee.'), pair('Ich bin fr√ºh gekommen.','I came early.') ]
  },

  {title:'Perfekt II', sub:'more participles', topics:[{h:'Partizip', body:'ge- + Stamm + -t/-en; trennbar: aufGESTANDEN'}],
   verbs:['aufstehen','einkaufen','anrufen','mitkommen','mitnehmen','aufmachen','zumachen','aufr√§umen','einladen','fernsehen','zur√ºckkommen','zur√ºckgeben','aufschreiben','vorstellen','vorbereiten','helfen'],
   dialogs:[dlg('Erfahrung',[['A','Hast du ihn angerufen?'],['B','Ja, ich habe ihn gestern angerufen.']])],
   sentences:[ pair('Ich habe eingekauft.','I did the shopping.'), pair('Wir sind fr√ºh aufgestanden.','We got up early.') ]
  },

  {title:'Future basics', sub:'werden + Infinitiv', topics:[{h:'Futur I', body:'Ich werde morgen arbeiten.'}],
   verbs:['werden','arbeiten','lernen','fahren','gehen','kommen','sehen','treffen','besuchen','kaufen','planen','vorhaben','sprechen','schreiben','lesen','spielen'],
   dialogs:[dlg('Planung',[['A','Was wirst du morgen machen?'],['B','Ich werde lernen.']])],
   sentences:[ pair('Wir werden zusammen kommen.','We will come together.') ]
  },

  {title:'Connectors', sub:'und, aber, oder, denn, weil, dass', topics:[{h:'Konjunktionen', body:'Verb-end with weil, dass: Ich bleibe zu Hause, weil ich m√ºde bin.'}],
   verbs:['bleiben','gehen','kommen','arbeiten','lernen','helfen','brauchen','m√∂gen','wollen','m√ºssen','k√∂nnen','d√ºrfen','sollen','sehen','sprechen','denken'],
   dialogs:[dlg('Begr√ºndung',[['A','Ich komme sp√§ter, weil ich arbeite.'],['B','Alles klar.']])],
   sentences:[ pair('Ich denke, dass er kommt.','I think that he is coming.') ]
  },

  {title:'Imperative', sub:'Komm! Gehen wir!', topics:[{h:'Imperativ', body:'du: Komm! ihr: Kommt! wir/Sie: Gehen wir!/Gehen Sie!'}],
   verbs:['kommen','gehen','warten','helfen','lesen','schreiben','sprechen','√∂ffnen','schlie√üen','aufstehen','aufmachen','zuh√∂ren','ansehen','mitkommen','mitnehmen','aufr√§umen'],
   dialogs:[dlg('Anweisungen',[['A','Bitte √∂ffne das Fenster.'],['B','Gern!']])],
   sentences:[ pair('Komm hierher!','Come here!') ]
  },

  {title:'Situations', sub:'Doctor / Post / Restaurant', topics:[{h:'Arzt', body:'Ich habe Kopfschmerzen. Ich brauche einen Termin.'},{h:'Post', body:'Ich m√∂chte ein Paket schicken.'},{h:'Restaurant', body:'Ich h√§tte gern die Speisekarte.'}],
   verbs:['brauchen','haben','sein','f√ºhlen','schmerzen','schicken','bekommen','bestellen','bezahlen','probieren','schmecken','helfen','geben','nehmen','bringen','zeigen'],
   dialogs:[dlg('Beim Arzt',[['Patient','Ich habe Fieber.'],['Arzt','Seit wann?'],['Patient','Seit gestern.']])],
   sentences:[ pair('Ich brauche einen Termin.','I need an appointment.') ]
  },

  {title:'Fillers & Small talk', sub:'also, na ja, genau‚Ä¶', topics:[{h:'Redemittel', body:'also, na ja, genau, vielleicht, eigentlich, √ºbrigens'}],
   verbs:['reden','sprechen','erz√§hlen','fragen','antworten','denken','glauben','finden','sehen','treffen','kennen','m√∂gen','lieben','arbeiten','lernen','spielen'],
   dialogs:[dlg('Small Talk',[['A','Sch√∂nes Wetter, oder?'],['B','Ja, genau!']])],
   sentences:[ pair('Also, ich glaube, das ist gut.','So, I think that is good.') ]
  },

  {title:'Final Review', sub:'All skills + test-yourself', topics:[{h:'Pr√ºfung', body:'H√∂ren, Sprechen, Lesen, Schreiben ‚Äî Rollenspiele + Wortschatztest.'}],
   verbs:['sein','haben','werden','k√∂nnen','m√ºssen','wollen','gehen','kommen','machen','sprechen','sehen','nehmen','geben','helfen','kaufen','arbeiten'],
   dialogs:[dlg('Wohnung mieten',[['A','Ist die Wohnung noch frei?'],['B','Ja, ab n√§chsten Monat.']])],
   sentences:[ pair('Ich habe viel gelernt.','I learned a lot.') ]
  }
];

/***********************
 *  RENDERING LOGIC    *
 ***********************/
const daysNav = document.getElementById('days');
DAYS.forEach((d, i)=>{
  const a = document.createElement('a');
  a.href = '#'; a.className = 'day'; a.dataset.day = i+1;
  a.innerHTML = `<div style="font-weight:700">Day ${i+1}</div><span class="tag">${d.title}</span>`;
  a.addEventListener('click', e=>{e.preventDefault(); loadDay(i+1); setActive(i+1);});
  daysNav.appendChild(a);
});
function setActive(n){
  [...daysNav.querySelectorAll('.day')].forEach((el,idx)=>{
    el.classList.toggle('active', idx===n-1);
  });
}
const gramEl = document.getElementById('grammar');
function renderGrammar(day){
  gramEl.innerHTML = '';
  day.topics.forEach(t=>{
    const det = document.createElement('details');
    det.open = true;
    det.innerHTML = `<summary>${t.h}</summary><div class="muted" style="margin-top:6px">${t.body}</div>`;
    gramEl.appendChild(det);
  });
}
function presentFor(v){
  if(v.class==='irr' && IRR[v.inf]) return IRR[v.inf];
  if(v.class==='sep' && v.base){ return combineSeparable(v.prefix, v.base); }
  if(v.class==='sepirr' && v.base){
    const base = IRR[v.base] || conjRegular(v.base);
    const o={}; for(const k of ['ich','du','er','wir','ihr','sie']){ o[k] = base[k] + ' ' + v.prefix; } return o;
  }
  if(v.class==='comp'){
    const base = conjRegular('gehen');
    const o={}; for(const k of ['ich','du','er','wir','ihr','sie']){ o[k] = base[k] + ' spazieren'; } return o;
  }
  return conjRegular(v.inf);
}
function rowVerb(v){
  const p = presentFor(v);
  const tr = document.createElement('tr');
  tr.innerHTML = `<td><b>${v.inf}</b></td><td class="en">${v.en}</td>`+
  `<td>${p.ich}</td><td>${p.du}</td><td>${p.er}</td><td>${p.wir}</td><td>${p.ihr}</td><td>${p.sie}</td>`+
  `<td><button class="speak" data-text="${v.inf}" data-lang="de">üîä</button></td>`;
  return tr;
}
function exampleFor(v){
  const p = presentFor(v).ich;
  let de, en;
  if(v.inf==='sein'){ de='Ich bin m√ºde.'; en='I am tired.'; }
  else if(v.inf==='haben'){ de='Ich habe Zeit.'; en='I have time.'; }
  else if(v.class==='sep' || v.class==='sepirr'){ de=`Ich ${p}.`; en=`I ${v.en.replace('to ','')}.`; }
  else { de=`Ich ${p}.`; en=`I ${v.en.replace('to ','')}.`; }
  return {de,en};
}
function renderVerbsOfDay(day){
  const tb = document.querySelector('#verbTable tbody'); tb.innerHTML='';
  const list = day.verbs.map(inf => VERB_DB.find(v=>v.inf===inf)).filter(Boolean);
  document.getElementById('verbCount').textContent = `${list.length} verbs`;
  list.forEach(v=> tb.appendChild(rowVerb(v)) );
}
function escapeHtml(t){return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function renderSentences(day){
  const box = document.getElementById('sentences'); box.innerHTML='';
  const chosen = [...day.sentences];
  day.verbs.slice(0,6).forEach(inf=>{ const v = VERB_DB.find(x=>x.inf===inf); if(v) chosen.push(exampleFor(v)); });
  chosen.forEach((s,i)=>{
    const item = document.createElement('div'); item.className='item';
    item.innerHTML = `<div class="row"><div><div class="de">${i+1}. ${s.de}</div><div class="en">${s.en}</div></div>
      <div>
        <button class="speak" data-text="${escapeHtml(s.de)}" data-lang="de">üîä DE</button>
        <button class="speak" data-text="${escapeHtml(s.en)}" data-lang="en">üîä EN</button>
        <button class="speak" data-both="${escapeHtml(s.de)}|||${escapeHtml(s.en)}">üîä DE‚ÜíEN</button>
      </div></div>`;
    box.appendChild(item);
  });
}
function renderDialogs(day){
  const box = document.getElementById('dialogs'); box.innerHTML='';
  day.dialogs.forEach(d=>{
    const det = document.createElement('details'); det.open=false;
    let inner = `<summary>${d.title}</summary>`;
    d.lines.forEach((ln, idx)=>{
      const who = ln[0]; const text = ln[1];
      inner += `<div class="row" style="margin-top:8px"><div><b>${who}:</b> <span class="de">${text}</span></div>
        <div><button class="speak" data-text="${escapeHtml(text)}" data-lang="de">üîä</button></div></div>`;
    });
    det.innerHTML = inner;
    box.appendChild(det);
  });
}
function loadDay(n){
  const d = DAYS[n-1];
  document.getElementById('dayNo').textContent = n;
  document.getElementById('dayTitle').textContent = d.title;
  document.getElementById('daySub').textContent = d.sub;
  renderGrammar(d);
  renderVerbsOfDay(d);
  renderSentences(d);
  renderDialogs(d);
}
function setUpEvents(){
  document.addEventListener('click', (e)=>{
    const b = e.target.closest('.speak');
    if(!b) return;
    if(b.dataset.both){
      const [de,en] = b.dataset.both.split('|||');
      speakSeq([{text:decode(de), lang:'de'}, {text:decode(en), lang:'en'}]);
    }else{
      speak(b.dataset.text? decode(b.dataset.text):'', b.dataset.lang||'de');
    }
  });
  document.getElementById('playDay').addEventListener('click', ()=>{
    const items = [...document.querySelectorAll('#sentences .item .de')].map(el=>el.textContent.replace(/^\\d+\\.\\s*/,'').trim());
    speakSeq(items.map(t=>({text:t, lang:'de'})));
  });
  document.getElementById('stopAll').addEventListener('click', ()=> speechSynthesis.cancel());
  document.getElementById('btnSearch').addEventListener('click', doSearch);
  document.getElementById('q').addEventListener('keydown', (e)=>{ if(e.key==='Enter') doSearch(); });
}
function decode(t){ const d=document.createElement('textarea'); d.innerHTML=t; return d.value; }

// TTS
let VOICES=[];
function loadVoices(){
  VOICES = speechSynthesis.getVoices();
  const deSel = document.getElementById('deVoice');
  const enSel = document.getElementById('enVoice');
  function fill(sel, filter){
    const cur = sel.value;
    sel.innerHTML='';
    VOICES.filter(filter).forEach(v=>{
      const opt = document.createElement('option');
      opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
      sel.appendChild(opt);
    });
    if(cur) sel.value = cur;
  }
  fill(deSel, v => (v.lang||'').toLowerCase().startsWith('de'));
  fill(enSel, v => (v.lang||'').toLowerCase().startsWith('en'));
}
speechSynthesis.onvoiceschanged = loadVoices;
function speak(text, lang){
  const u = new SpeechSynthesisUtterance(text);
  const rate = parseFloat(document.getElementById('rate').value||'1');
  const pitch = parseFloat(document.getElementById('pitch').value||'1');
  u.rate=rate; u.pitch=pitch;
  u.lang=(lang==='de'?'de-DE':'en-US');
  const sel = (lang==='de'?document.getElementById('deVoice'):document.getElementById('enVoice'));
  const name = sel.value; if(name){ const v = VOICES.find(v=>v.name===name); if(v) u.voice=v; }
  speechSynthesis.speak(u);
}
function speakSeq(arr){
  if(!arr.length) return;
  const [first, ...rest] = arr;
  const u = new SpeechSynthesisUtterance(first.text);
  u.lang = first.lang==='de'?'de-DE':'en-US';
  const rate = parseFloat(document.getElementById('rate').value||'1');
  const pitch = parseFloat(document.getElementById('pitch').value||'1');
  u.rate=rate; u.pitch=pitch;
  const sel = (first.lang==='de'?document.getElementById('deVoice'):document.getElementById('enVoice'));
  const name = sel.value; if(name){ const v = VOICES.find(v=>v.name===name); if(v) u.voice=v; }
  u.onend = ()=> speakSeq(rest);
  speechSynthesis.speak(u);
}

// Simple search: jump to day that contains verb or sentence substring
function doSearch(){
  const q = (document.getElementById('q').value||'').toLowerCase().trim();
  if(!q){ return; }
  // search verbs
  for(let i=0;i<DAYS.length;i++){
    const d = DAYS[i];
    const hasVerb = d.verbs.some(inf=> inf.toLowerCase().includes(q));
    const hasSent = d.sentences.some(s=> s.de.toLowerCase().includes(q) || s.en.toLowerCase().includes(q));
    if(hasVerb || hasSent){
      loadDay(i+1); setActive(i+1); return;
    }
  }
  alert('No match in this curriculum. Try another term.');
}

// Init
loadVoices();
setActive(1);
loadDay(1);
setUpEvents();
</script>
</body>
</html>
